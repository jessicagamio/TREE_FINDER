{% extends 'base.html' %}


{% block content %}

<div class="container">



   {% if value >= 10 %}
        <div class="row" id="prediction-first-row">
            <div class="col" id="result-image">
                <img src="{{image}}" id="prediction-image" width="400" height="400">
            </div>


            <div class="col" id="result-facts">

                  <!--   {% if value >= 10 %} -->

                    <h1 class="title">{{common_name}} </h1>
                    <div>
                        <h2>Facts about {{common_name}}'s</h2>
                        <p>
                        Scientific Name: {{sci_name}}<br>
                        Common Name: {{common_name}}<br>
                        Leaf Shape: {{shape}}<br>
                        Leaf Margin: {{margin}}<br>
                        Leaf Venation: {{venation}}<br>
                        Facts: {{factoid}}<br>
                    <!--     <img src="{{image}}"> -->
                        <br>
                        <button  data-sci-name= "{{sci_name}}" type="button" class="btn btn-success" id="treehugs">Hugs</button>
                        </p>
                    </div>
            </div>
        </div>
          <!--   </div> -->
    <div class="row" id="prediction-second-row">
        <!-- <div class="col-2"></div> -->
            <div class="col-8" id="map-result">
                <h1>{{common_name}} found in San Francisco</h1>
                <div id="map"></div>
            </div>
        <!-- <div class="col-2"></div> -->
      
    </div>
<script>


    function initMap(){
        const sfBayCoords={lat: 37.7809825, lng:-122.444124};

        const map = new google.maps.Map(document.getElementById('map'),{
                center: sfBayCoords,
                zoom:15
        });


        const markers = {{ markers|tojson }};

        for (let mark of markers){
            let [ lat, lng ] = mark;
            // console.log(lat,lng);
            let marker = new google.maps.Marker(
                { 
                    position: {
                        lat: lat,
                        lng: lng
                    },
                    map: map
                }
            );
        }

         if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            // console.log(pos);
            let user_marker= new google.maps.Marker(
                {position:pos,map:map});
        })
    }

}



     function processHug(evt){
    
        function hugCoord(){

            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude }; })
        }

        const userSession = $('#logout-button').data('session');
        evt.preventDefault();
        
        if (userSession){ 

            const hugs = document.getElementById('treehugs');

            function changeToRed(){
                hugs.class="btn btn-danger";
                $('#treehugs').html("Hugged");
            }

            const hugInfo = {
                'tree_species':$('#treehugs').data('sciName'),
                'user_id': $('#logout-button').data('session')     
            };
           
            $.post('/hugs',hugInfo,changeToRed);
        }

    }

    $('#treehugs').on('click', processHug);

   
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBh0-bI-EUg1Pgpy7QT_tTqGBwNDA431o4&callback=initMap">
</script>

<!-- {% endif %} -->

{% elif value == 0 %}
    
    <div class="row">
        <div class="col" >
            <div id="no-match-found">
                <h1>No match found.</h1>
            </div>
        </div>
    </div>
{% endif %}


</div>
{% endblock %}